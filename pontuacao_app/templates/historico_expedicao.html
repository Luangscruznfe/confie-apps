{% extends 'base.html' %}

{% block title %}Hist√≥rico de Pontua√ß√£o - Expedi√ß√£o{% endblock %}

{% block content %}
<div class="container mt-4">
  <h2 class="mb-4">üìà Hist√≥rico de Pontua√ß√£o - Expedi√ß√£o</h2>

<form method="get" class="row g-2 mb-3">
  <div class="col-12 col-md-3">
    <label class="form-label">Respons√°vel</label>
    <select name="responsavel" class="form-select">
      <option value="">(Todos)</option>
      <option value="GERENTE_ADM" {{ 'selected' if responsavel=='GERENTE_ADM' else '' }}>Ger. ADM</option>
      <option value="FATURAMENTO" {{ 'selected' if responsavel=='FATURAMENTO' else '' }}>Faturamento</option>
      <option value="FINANCEIRO"  {{ 'selected' if responsavel=='FINANCEIRO'  else '' }}>Financeiro</option>
      <option value="RH"          {{ 'selected' if responsavel=='RH'          else '' }}>RH</option>
    </select>
    <small class="text-muted d-block">A = Ger. ADM ‚Ä¢ B = Faturamento ‚Ä¢ C/D = Financeiro ‚Ä¢ E = RH</small>
  </div>

  <div class="col-6 col-md-2">
    <label class="form-label">In√≠cio</label>
    <input type="text" name="inicio" class="form-control" placeholder="dd/mm/aaaa" value="{{ inicio or '' }}">
  </div>

  <div class="col-6 col-md-2">
    <label class="form-label">Fim</label>
    <input type="text" name="fim" class="form-control" placeholder="dd/mm/aaaa" value="{{ fim or '' }}">
  </div>

  <div class="col-6 col-md-2 d-flex align-items-end">
    <button class="btn btn-primary w-100" type="submit">Filtrar</button>
  </div>

  <div class="col-6 col-md-2 d-flex align-items-end">
    <a class="btn btn-secondary w-100" href="{{ request.path }}">Limpar</a>
  </div>
</form>


  <!-- Torna a tabela rol√°vel no celular -->
  <div class="table-responsive">
    <table class="table table-bordered text-white">
      <thead class="table-dark">
        <tr>
          <th>ID</th>
          <th>Data</th>
          <th>
            Organiza√ß√£o e limpeza estoque<br>
            <span class="text-warning">(Gerente ADM)</span>
          </th>
          <th>
            Separa√ß√£o/confer√™ncia do mapa corretamente<br>
            <span style="color: #2ecc71;">(Faturamento)</span>
          </th>
          <th>
            Faturamento OK<br>
            <span style="color: red;">(Financeiro)</span>
          </th>
          <th>
            Erro ou devolu√ß√£o / falta na entrega<br>
            <span style="color: red;">(Financeiro)</span>
          </th>
          <th>
            Finaliza√ß√£o ap√≥s hor√°rio<br>(abaixo de 50k)<br>
            <span style="color: #6c5ce7;">(RH)</span>
          </th>
          <th>Extras</th>
          <th>Total</th>
          <th>Observa√ß√£o</th>
        </tr>
      </thead>

      <tbody>
        {% for r in registros %}
        <tr>
          <td>{{ r[0] }}</td>  <!-- ID -->
          <td>{{ r[1]|datetimeformat }}</td>  <!-- Data -->
          <td>{{ r[2] }}</td>  <!-- Organiza√ß√£o -->
          <td>{{ r[3] }}</td>  <!-- Separa√ß√£o -->
          <td>{{ r[4] }}</td>  <!-- Faturamento OK -->
          <td>{{ r[5] }}</td>  <!-- Erros / Devolu√ß√£o -->
          <td>{{ r[6] }}</td>  <!-- Finaliza√ß√£o ap√≥s hor√°rio -->
          <td>
            {% set extras = r[7] %}
            {% if extras %}
              {% if 'meta' in extras %}Meta de faturamento (+2)<br>{% endif %}
              {% if 'equipe90' in extras %}Equipe chegou a 90% de pontua√ß√£o (+1){% endif %}
            {% endif %}
          </td>
          <td>{{ r[8] }}</td>  <!-- Total -->
          <td>{{ r[9] if r[9] and r[9]|string|lower != 'nan' else '' }}</td>  <!-- Observa√ß√£o -->
        </tr>
        {% endfor %}
        <tr>
  <td colspan="8" class="text-end fw-bold">Total Geral:</td>
  <td class="fw-bold {% if total_geral >= 0 %}text-success{% else %}text-danger{% endif %}">
    {{ total_geral }}
  </td>
  <td></td>
</tr>
      </tbody>
    </table>
  </div>

  <a href="{{ url_for('home_pontuacao') }}" class="btn btn-secondary mt-3">üîô Voltar</a>
</div>

<style>
  .setor-gerente { color: #b58900; font-weight: bold; }
</style>
{% endblock %}
