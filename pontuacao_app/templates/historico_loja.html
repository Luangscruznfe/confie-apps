{% extends 'base.html' %}

{% block title %}Hist√≥rico de Pontua√ß√£o - Loja{% endblock %}

{% block content %}
<div class="container mt-4">
  <h2 class="mb-4">üõçÔ∏è Hist√≥rico de Pontua√ß√£o - Loja</h2>

<form method="get" class="row g-2 mb-3">
  <div class="col-12 col-md-3">
    <label class="form-label">Respons√°vel</label>
    <select name="responsavel" class="form-select">
      <option value="">(Todos)</option>
      <option value="GERENTE_ADM" {{ 'selected' if responsavel=='GERENTE_ADM' else '' }}>Ger. ADM</option>
      <option value="RH"          {{ 'selected' if responsavel=='RH'          else '' }}>RH</option>
      <option value="FINANCEIRO"  {{ 'selected' if responsavel=='FINANCEIRO'  else '' }}>Financeiro</option>
    </select>
    <small class="text-muted d-block">A/E = Ger. ADM ‚Ä¢ B/D = RH ‚Ä¢ C = Financeiro</small>
  </div>
  <div class="col-6 col-md-2">
    <label class="form-label">In√≠cio</label>
    <input type="text" name="inicio" class="form-control" placeholder="dd/mm/aaaa" value="{{ inicio or '' }}">
  </div>
  <div class="col-6 col-md-2">
    <label class="form-label">Fim</label>
    <input type="text" name="fim" class="form-control" placeholder="dd/mm/aaaa" value="{{ fim or '' }}">
  </div>
  <div class="col-6 col-md-2 d-flex align-items-end">
    <button class="btn btn-primary w-100" type="submit">Filtrar</button>
  </div>
  <div class="col-6 col-md-2 d-flex align-items-end">
    <a class="btn btn-secondary w-100" href="{{ request.path }}">Limpar</a>
  </div>
</form>

  <table class="table table-bordered table-striped">
    <thead>
      <tr>
	<th>ID</th>
        <th>Data</th>
        <th>Organiza√ß√£o da loja <span class="setor-gerente">(Gerente ADM)</span></th>
        <th>Pontualidade <span class="setor-rh">(RH)</span></th>
        <th>Fechamento do caixa <span class="setor-financeiro">(Financeiro)</span></th>
        <th>N√£o postar em rede social <span class="setor-rh">(RH)</span></th>
        <th>Validade / Avaria <span class="setor-gerente">(Gerente ADM)</span></th>
        <th>Extras</th>
        <th>Total</th>
        <th>Observa√ß√£o</th>
      </tr>
    </thead>
    <tbody>
  {% for r in registros %}
  <tr>
    <td>{{ r[0] }}</td>  <!-- ID -->
    <td>{{ r[1]|datetimeformat }}</td>  
    <td>{{ r[2] }}</td>  <!-- Organiza√ß√£o da loja (A) -->
    <td>{{ r[3] }}</td>  <!-- Pontualidade (B) -->
    <td>{{ r[4] }}</td>  <!-- Fechamento do caixa (C) -->
    <td>{{ r[5] }}</td>  <!-- N√£o postar em rede social (D) -->
    <td>{{ r[6] }}</td>  <!-- Validade / Avaria (E) -->
    <td>
      {% set extras = r[7] %}
      {% if 'meta' in extras %}Meta de faturamento (+2)<br>{% endif %}
      {% if 'equipe90' in extras %}Equipe chegou a 90% de pontua√ß√£o (+1){% endif %}
    </td>
    <td>{{ r[8] }}</td>  <!-- Total -->
    <td>{{ r[9] if r[9] and r[9]|string|lower != 'nan' else '' }}</td>  <!-- Observa√ß√£o -->
  </tr>
  {% endfor %}
  <tr>
    <td colspan="8" class="text-end fw-bold">Total Geral:</td>
    <td class="fw-bold {% if total_geral >= 0 %}text-success{% else %}text-danger{% endif %}">
      {{ total_geral }}
    </td>
    <td></td>
  </tr>
</tbody>

  </table>

  <a href="{{ url_for('home_pontuacao') }}" class="btn btn-secondary mt-3">üîô Voltar</a>
</div>

<style>
  .setor-gerente { color: #b58900; font-weight: bold; }
  .setor-rh { color: #6c5ce7; font-weight: bold; }
  .setor-financeiro { color: #e74c3c; font-weight: bold; }
</style>
{% endblock %}
